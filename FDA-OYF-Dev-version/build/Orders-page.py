
# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer

from math import ceil

from pathlib import Path
import mysql.connector as sql 
# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage, Frame , Scrollbar, StringVar, Label

def relative_to_assets4(path: str) -> Path:
    return ASSETS_PATH4 / Path(path)

# Return Itemname from itemid         
def return_itemname(itemid):
   cur.execute('select ItemId,Item_Name from items  ')
   itemid_and_name = cur.fetchall()
   for i in itemid_and_name :
       item_id , item_name = i
       if item_id == itemid :
           return item_name 
           break
  
# Return Item Price by computing base price and price %
def return_itemprice(itemid):
    
    cur.execute('select pricepercent from hotel_details where hotelid = %s',(Selected_Restaurant,))
    (Price_percent,) = cur.fetchone()

    cur.execute('select BasePrice from items where ItemId = %s',(itemid,))
    (Base_price,) =  cur.fetchone()

    Price_of_item = Base_price * ((100 + Price_percent)/100)
    
    return str(int(Price_of_item))



# Fetch User and Hotel Details From SQL -   for orders canvas
def sqlfetch_user_hotel_datails():
    
    global Password,Hotel_Details,Personal_Details
    
    cur.execute("Select name,phoneno,address from personal_details where custid = %s",(Current_CustID,))
    Details = cur.fetchall()
    [Personal_Details] = Details

    cur.execute("Select hotel_name,address,city,state,taxpercent from hotel_details where HotelId = %s",(Selected_Restaurant,))
    Details = cur.fetchall()
    [Hotel_Details] = Details
        

# Clear the labels orders canvas
def clear_orderitemlabels():
    global orderitems_price_label_list,orderitemslabel_list

    for k in orderitemslabel_list.copy():
        orderitemslabel_list.remove(k)
        k.destroy()
    for l in orderitems_price_label_list.copy():
        orderitems_price_label_list.remove(l)
        l.destroy()
        
# Create item labels inside a canvas (frame with scrollbar) 
def create_itemlabels(): 
    global label2,orderitemslabel_list, canvas7 ,scrollbar3,frame4,Item_Total,orderitems_price_label_list
  
    if 'canvas7' in globals() :
        frame4.destroy()
        canvas7.destroy()
        scrollbar3.destroy()
        
    canvas7 = Canvas(window,
                 bg = '#656565',
                 width = 410,         
                 height = 300,
                 )             
    canvas7.place(x = 530, y = 70)

    frame4 = Frame(canvas7,width =450,height = 400,bg= "#656565")
   
    #Creating another scrollbar
    scrollbar3 = Scrollbar(window, command=canvas7.yview)
    scrollbar3.place(x=950, y=70)
    scrollbar3.place(height=300)

    canvas7.configure(yscrollcommand=scrollbar3.set)
    canvas7.bind('<Configure>', lambda e: canvas7.configure(scrollregion=canvas7.bbox("all")))
    #canvas7.pack(side=RIGHT, fill=BOTH, expand=TRUE)
    window3_height = 55 * len(dict_items)
    canvas7.create_window((0, 0),   
                     height = window3_height,
                     width=450,
                     window=frame4,
                     anchor='nw')
    
    if len(dict_items) > 0 :
        clear_orderitemlabels()
    
    # Creating Label
    Item_Total = 0 
    Ycoor = 15   
    for i in dict_items: 
        
        Item_Name = return_itemname(i)
        Item_Price = return_itemprice(i)
        Quantity = str(dict_items[i])
        Amount = str( int(Item_Price) * int(Quantity) ) 
        Item_Total += int(Amount)
        
        text_inside_label = '   '+Item_Name + ' ( ' + Item_Price+ ' Rs) X '+ Quantity
        label3 = Label(frame4,text = text_inside_label , width = 30,height = 2, font = ('Arial', 12), anchor="w") #Creating Labels List[i] will return the respective string (hotelid/itemid)
        label3.place(x=20,y = Ycoor)
        
        orderitemslabel_list.append(label3) 
        
        label4 =Label(frame4,text = 'Rs '+ Amount , width = 10,height = 2, font = ('Arial', 12)) #Creating Labels List[i] will return the respective string (hotelid/itemid)
        label4.place(x=300,y = Ycoor)
        
        orderitems_price_label_list.append(label4)

        Ycoor += 50 
        # Incrementing Y coordinates
 
# Order Summary Canvas
def ordercanvas():
    global canvas6,bgimage,image_image_2,address_bg,Edit_Items_Button_img,PlaceOrder_Button_bg,image_image_4,GST, Platform_Fee,Grand_Total,address_entry_1
    global window,window_height,window_width
    
    window.title("Jishnu's Food Delivery Application - oyFood - OrderSummary")

    window_height = 600
    window_width = 1000
    
    canvas6 = Canvas(
        window,
        bg = "#CDC6C6",
        height = 600,
        width = 1000,
        bd = 0,
        highlightthickness = 0,
        relief = "ridge"
    )

    canvas6.place(x = 0, y = 0)

    bgimage = PhotoImage(
        file=relative_to_assets4("image_1.png"))

    bg = canvas6.create_image(
        501.0,
        300.0,
        image=bgimage
    )
   
    sqlfetch_user_hotel_datails()
    create_itemlabels()

    # Labels of name and Phno: 
    Name = Label(canvas6,
                 text = '  '+Personal_Details[0],
                 font = ('Times New Roman',18),
                 anchor = 'w')
    
    Name.place(x = 35.0, y = 120.0,width = 320,height = 40)

    Phno = Label(canvas6,
                 text = '  '+str(Personal_Details[1]),
                 font = ('Times New Roman',18),
                 anchor = 'w')
    
    Phno.place(x = 35.0, y = 195.0,width = 320,height = 40)
    
    address_bg = PhotoImage(
        file=relative_to_assets4("entry_1.png"))

    address_entry_bg_1 = canvas6.create_image(
        251.0,
        330.5,
        image=address_bg
    )
    
    Address = ((Personal_Details[2].split(' | '))[0]+' '+ (Personal_Details[2].split(' | '))[1])
    
    address_entry_1 = Text(canvas6,
        bd=0,
        font = ('Helvatica',15),
        bg="#D9D9D9",
        fg="#000716",
        highlightthickness=0
    )
    
    address_entry_1.insert("1.0", Address)
    #text_value = entry_1.get("1.0", "end-1c")

    address_entry_1.place(
        x=40.0,
        y=275.0,
        width=410.0,
        height=120.0
    )

    Edit_Items_Button_img = PhotoImage(
        file=relative_to_assets4("button_1.png"))

    Edit_Items_Button = Button(canvas6,
        image=Edit_Items_Button_img,
        borderwidth=0,
        highlightthickness=0,
        relief="flat"
    )

    Edit_Items_Button.place(
        x=535.0,
        y=535.0,
        width=213.0,
        height=39.0
    )

    PlaceOrder_Button_bg = PhotoImage(
        file=relative_to_assets4("button_2.png"))

    Place_Order_Button = Button(canvas6,
        image=PlaceOrder_Button_bg,
        borderwidth=0,
        highlightthickness=0,
        relief="flat"
    )

    Place_Order_Button.place(
        x=762.0,
        y=535.0,
        width=213.0,
        height=39.0
    )

    image_image_4 = PhotoImage(
        file=relative_to_assets4("image_4.png"))

    # Hotel Details Bg
    image_4 = canvas6.create_image(
        254.0,
        510.0,
        image=image_image_4
    )
    # Total Amount Bg 
    image_5 = canvas6.create_image(
        751.0,
        450.0,
        image=image_image_4
    )
    
    #Name
    canvas6.create_text(
        31.0,
        103.0,
        anchor="nw",
        text="Name : ",
        fill="#F7EFEF",
        font=("Inter", 14 * -1)
    )
    #Phone Number
    canvas6.create_text(
        30.5,
        178.0,
        anchor="nw",
        text="Phone Number :",
        fill="#F7EFEF",
        font=("Inter", 14 * -1)
    )
    
    #Delivery Address
    canvas6.create_text(
        30.5,
        247.0,
        anchor="nw",
        text="Delivery Address : (Modify if Required)",
        fill="#F7EFEF",
        font=("Inter", 14 * -1)
    )
    #Item Details
    canvas6.create_text(
        530.0,
        38.0,
        anchor="nw",
        text="Item Details",
        fill="#FFFFFF",
        font=("Inter Bold", 25 * -1)
    )
    #Order Summary
    canvas6.create_text(
        30.5,
        9.0,
        anchor="nw",
        text="Order Summary",
        fill="#FFFFFF",
        font=("Inter Bold", 30 , 'bold')
    )
    #Delivary Details
    canvas6.create_text(
        33.0,
        65.0,
        anchor="nw",
        text="Delivery Details",
        fill="#FFFFFF",
        font=("Inter Bold", 25 * -1)
    )
    #Hotel Details
    canvas6.create_text(
        33.0,
        410.0,
        anchor="nw",
        text="Hotel Details",
        fill="#FFFFFF",
        font=("Inter Bold", 25 * -1)
    )
    
    #Line
    canvas6.create_rectangle(
        502.0,
        30.0,
        507.0,
        567.0,
        fill="#000000",
        outline="")
    
    
    # Texts for Hotel Details
    
    # hotel_name,address,city,state,taxpercent 

    canvas6.create_text(
        50.0,
        465.0,
        anchor="nw",
        text=Hotel_Details[0]+',\n'+Hotel_Details[1]+',\n'+Hotel_Details[2]+', '+Hotel_Details[3]+'.\nTax : '+str(Hotel_Details[4])+'%' ,
        font=("Inter Bold", 20 * -1)
    )

    canvas6.create_text(
        550.0,
        400.0,
        anchor="nw",
        text="Total Amount : Rs " + str(Item_Total),
        font=("Inter Bold", 20 * -1)
    )    
    
    GST = (Hotel_Details[4]/100)*Item_Total
    tempValue = ceil(GST*100)/100
    GST = tempValue
    
    canvas6.create_text(
        550.0,
        428.0,
        anchor="nw",
        text='Goods and Services Tax (GST) : '+str(Hotel_Details[4])+'%  -  Rs '+ str(GST),
        font=("Inter Bold", 16 * -1)
    )
    
    Platform_Fee = 0.05*Item_Total
    tempValue = ceil(Platform_Fee*100)/100
    Platform_Fee = tempValue
    
    canvas6.create_text(
        550.0,
        450.0,
        anchor="nw",
        text='Platform Fee : 5%  -  Rs ' + str(Platform_Fee),
        font=("Inter Bold", 16 * -1)
    )
    
    Grand_Total = Item_Total + GST + Platform_Fee 
    tempValue = ceil(Grand_Total*100)/100
    Grand_Total = tempValue

    canvas6.create_text(
        550.0,
        475.0,
        anchor="nw",
        text="Grand Total : Rs " + str(Grand_Total),
        font=("Inter Bold", 20 * -1)
    )    


OUTPUT_PATH4 = Path(__file__).parent
ASSETS_PATH4 = OUTPUT_PATH4 / Path(r"assets\frame4")


window = Tk()

window.geometry("1000x600")
window.configure(bg = "#CDC6C6")
window.title("Jishnu's Food Delivery Application - oyFood - Order Confirmation")


con = sql.connect(host='localhost',user = 'root',password = 'mysqlrootpwd',database='food_delivery_application')
cur = con.cursor()


dict_items = {1: '1', 2: '5', 3: '1', 4: '1', 5: '1'}


Current_UserID = 'jishnu.one'              # Current User 
Selected_Restaurant = 1         # Current Restaurant
Current_CustID = 1
Item_Total = 0 
orderitemslabel_list = []
orderitems_price_label_list = []
Item_Total = 0
GST = 0
Platform_Fee = 0
Grand_Total = 0

ordercanvas()



window.resizable(False, False)
window.mainloop()
